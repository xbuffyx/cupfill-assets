<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cup Fill — Mojito Edition</title>
<style>
html, body { margin:0; padding:0; background:transparent; }
.wrap { position:relative; width:100vw; height:100vh; overflow:hidden; }
.glass {
  position:absolute; left:50%; top:50%; transform:translate(-50%, -50%);
  width:min(220px, 70vw); height:min(480px, 80vh);
  border:2px solid rgba(255,255,255,0.35);
  border-radius:24px 24px 14px 14px / 24px 24px 10px 10px;
  box-shadow:0 0 24px rgba(255,255,255,0.12) inset, 0 0 40px rgba(176,137,255,0.15);
  overflow:hidden;
}
.fill {
  position:absolute; bottom:0; left:0; width:100%;
  background: linear-gradient(180deg, #ffe1f6 0%, #b089ff 100%);
  height:0%;
  transition: height 1000ms ease-in-out;
  filter: drop-shadow(0 0 12px rgba(176,137,255,0.35));
}
.rim {
  position:absolute; top:0; left:0; width:100%; height:10px;
  box-shadow: 0 0 18px rgba(255,255,255,0);
  transition: box-shadow 800ms ease;
  pointer-events:none;
}
.bubble { 
  position:absolute; bottom:0; width:8px; height:8px; border-radius:50%;
  background: rgba(255,255,255,0.9);
  opacity:0.0; filter: blur(0.2px);
  animation: floatUp linear forwards;
}
@keyframes floatUp {
  0%   { transform: translateY(0) translateX(0) scale(0.7); opacity:0.0; }
  10%  { opacity:0.35; }
  100% { transform: translateY(-90%) translateX(var(--x)) scale(1.0); opacity:0.0; }
}
.caption {
  position:absolute; width:100%; text-align:center; left:0;
  top:calc(50% + min(280px, 45vh)); transform: translateY(-50%);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color: #ffffff; opacity:0.9; font-weight:600; letter-spacing:0.3px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.35);
}
</style>
</head>
<body>
<div class="wrap">
  <div class="glass">
    <div id="fill" class="fill"></div>
    <div id="rim" class="rim"></div>
  </div>
  <div class="caption" id="caption">Loading…</div>
</div>
<script>
const params = new URLSearchParams(location.search);
const src = params.get('src') || 'cupfill.json';
fetch(src, {cache: 'no-store'}).then(r => r.json()).then(cfg => {
  const fill = document.getElementById('fill');
  const rim  = document.getElementById('rim');
  const cap  = document.getElementById('caption');
  const pct  = Math.max(0, Math.min(1, Number(cfg.percent || 0)));
  const bubbles = cfg.bubbles || {enabled:true, style:'slow-elegant', color:'#FFFFFF', density:0.12};
  fill.style.height = (pct*100).toFixed(1) + '%';
  cap.textContent = ((pct*100).toFixed(0)) + '% funded';
  if (cfg.rimGlow && cfg.rimGlow.enabled && pct >= (cfg.rimGlow.atPercent || 1)) {
    rim.style.boxShadow = '0 0 22px ' + (cfg.rimGlow.color || '#FFFFFF');
  }
  if (bubbles.enabled) {
    const glass = document.querySelector('.glass');
    const count = Math.floor(50 * (bubbles.density || 0.12) * (pct));
    for (let i=0;i<count;i++) {
      const b = document.createElement('div');
      b.className = 'bubble';
      const left = 10 + Math.random()*80;
      const delay = Math.random()*3.0 + 0.2;
      const dur = 3.5 + Math.random()*2.0;
      b.style.left = left + '%';
      b.style.setProperty('--x', (Math.random()*10 - 5) + 'px');
      b.style.animationDuration = dur + 's';
      b.style.animationDelay = delay + 's';
      glass.appendChild(b);
      setTimeout(()=>glass.removeChild(b), (delay+dur)*1000 + 500);
    }
  }
});
</script>
</body>
</html>
